## HedgeAI

AI-powered investment research, portfolio debate, and backtesting toolkit. Two persona agents (Warren Buffett and Cathie Wood) debate each holding, a moderator synthesizes consensus, and a portfolio layer proposes rebalancing. Includes a Python backtester and a React dashboard for visualization.

### Features

- **Agent analyses**: `WarrenBuffettAgent` and `CathieWoodAgent` generate signals, confidence, and reasoning.
- **Moderated debates**: `ModeratorAgent` identifies disagreements, conducts cross-examination, and synthesizes a consensus.
- **Portfolio engine**: Runs debates for each holding, computes suggested weights, and emits JSON trading actions.
- **Backtesting**: Quarterly or daily simulation with trade execution and benchmark comparison (SPY).
- **Dashboard**: React + Vite dashboard to visualize backtest iterations and portfolio state.

### Requirements

- Python 3.8+
- Node 18+ (for the dashboard)

Python dependencies are listed in `requirements.txt`. The backtester also requires:

- `matplotlib`
- `colorama`

Install them if missing:

```bash
pip install matplotlib colorama
```

### Environment variables (.env)

Create a `.env` file in the repo root with:

```bash
# LLM providers
OPENAI_API_KEY=your_openai_api_key   # required for real LLM calls
ANTHROPIC_API_KEY=your_anthropic_key # optional

# Defaults (optional)
DEFAULT_LLM_PROVIDER=openai          # openai | anthropic | cerebras
DEFAULT_MODEL=gpt-4o-mini            # any model your provider supports

# Financial data API (required for real backtesting/data fetches)
FINANCIAL_DATASETS_API_KEY=your_financialdatasets_api_key
```

Notes:

- If LLM keys are missing or set to placeholders, the system runs in a deterministic "demo mode" with mock outputs for quick testing.
- The backtester fetches prices, metrics, news, and insider trades via `https://api.financialdatasets.ai/` and needs `FINANCIAL_DATASETS_API_KEY` for reliable runs.

### Setup

```bash
git clone <this-repo>
cd HedgeAI

# (recommended) create a virtual env
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# install Python deps
pip install -r requirements.txt
pip install matplotlib colorama

# create your env file
cp .env.example .env  # if present, else create .env and paste the variables above
```

### How to run

Run commands from the project root unless otherwise noted. For Python modules that import within `src/`, change directory into `src` first.

#### 1) Single-stock agent analysis

```bash
cd src
python main.py AAPL                 # analyze one ticker with both agents
python main.py AAPL TSLA NVDA      # compare multiple tickers
```

#### 2) Moderated debate (per stock)

```bash
cd src
python consensus_debate.py AAPL
python consensus_debate.py AAPL TSLA NVDA
```

#### 3) Portfolio debate (rebalancing JSON output)

```bash
cd src

# Predefined portfolios: tech_growth, value_dividend, balanced_mix, ai_innovation
python portfolio_debate.py tech_growth

# Custom portfolio (weights must sum to 1.0)
python portfolio_debate.py custom AAPL:0.4 MSFT:0.3 GOOGL:0.3

# Quarterly, with historical quarterly context
python portfolio_debate.py quarterly tech_growth
python portfolio_debate.py quarterly custom AAPL:0.5 MSFT:0.3 GOOGL:0.2
```

On completion, a trading actions JSON file is saved at the repo root, e.g. `trading_actions_regular_<portfolio>.json` or `trading_actions_quarterly_<portfolio>.json`.

#### 4) Backtesting (portfolio debate integrated)

```bash
cd src
# Usage: python portfolio_backtester.py <portfolio_name> [start_date] [end_date] [initial_capital]
python portfolio_backtester.py tech_growth
python portfolio_backtester.py tech_growth 2024-01-01 2024-12-31 100000
```

Outputs are written to `backtest_results/`:

- `backtest_data.json`: consolidated iterations (portfolio value, cash, positions, executed trades, prices)
- `backtest_master_log.jsonl`: one-line summary per run (final value, returns, Sharpe, drawdown, trades)
- `latest_portfolio_state.json`: last known portfolio snapshot and performance

You can also quickly run a one-year test:

```bash
cd src
python test_portfolio_backtest.py [portfolio_name] [initial_capital]
# example
python test_portfolio_backtest.py tech_growth 100000
```

### Dashboard (optional)

```bash
cd dashboard
npm install
npm run dev
```

Open the URL printed by Vite. The dashboard expects to find `backtest_results/` in the project root and will visualize `backtest_data.json` and `latest_portfolio_state.json` generated by the backtester.

### Project structure

```
HedgeAI/
├── src/
│   ├── agents/                       # Buffett/Wood agents + moderator
│   ├── consensus_debate.py           # Single-stock moderated debate
│   ├── portfolio_debate.py           # Portfolio-level debates and JSON actions
│   ├── portfolio_backtester.py       # Backtester using the debate system
│   ├── quarterly_data_extractor.py   # Quarterly context for debates
│   ├── tools/                        # API client + caching/models
│   ├── utils.py                      # LLM client selection, demo mode, helpers
│   └── main.py                       # CLI to analyze tickers with both agents
├── backtest_results/                 # Backtester outputs (created at run-time)
├── portfolios/                       # Example portfolio JSONs
├── dashboard/                        # React + Vite dashboard
├── requirements.txt
└── README.md
```

### Tips and troubleshooting

- **Imports/paths**: For Python CLIs under `src/`, run from inside `src` (e.g., `cd src && python portfolio_debate.py tech_growth`).
- **Missing deps**: If plots or colors fail, install `matplotlib` and `colorama` (`pip install matplotlib colorama`).
- **API rate limits**: The client applies moderate backoff on HTTP 429s. Long runs may pause; ensure you have a valid API key and sufficient quota.
- **Demo mode**: Without real LLM keys, the system returns structured demo outputs so you can test end-to-end flows.

### License

For internal/experimental use. Add a license of your choice if distributing.
